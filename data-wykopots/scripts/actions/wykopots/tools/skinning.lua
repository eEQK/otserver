local config = {
	[5908] = {
		-- rabbits
		[4173] = { value = 25000, newItem = 12172, after = 4175 },
		--		[6017] = {value = 25000, newItem = 12172, after = 4302}, -- after being killed
		-- Apes
		[4333] = { value = 10000, newItem = 5883, after = 4334 }, -- kongra
		[4339] = { value = 10000, newItem = 5883, after = 4340 }, -- sibang
		[4336] = { value = 10000, newItem = 5883, after = 4337 }, -- merlkin

		--Tortoise
		[5624] = { value = 4000, newItem = 5899, after = 5625 }, -- tortoise
		[5627] = { value = 4000, newItem = 5899, after = 5628 }, -- thornback

		-- Minotaurs
		[4011] = { value = 25000, newItem = 5878, after = 4012 }, -- minotaur
		--		[5969] = {value = 25000, newItem = 5878, after = 4012}, -- minotaur, after being killed
		[4052] = { value = 25000, newItem = 5878, after = 4053 }, -- minotaur archer
		--		[5982] = {value = 25000, newItem = 5878, after = 4053}, -- minotaur archer, after being killed
		[4047] = { value = 25000, newItem = 5878, after = 4048 }, -- minotaur mage
		--		[5981] = {value = 25000, newItem = 5878, after = 4048}, -- minotaur mage, after being killed
		[4057] = { value = 25000, newItem = 5878, after = 4058 }, -- minotaur guard/invader
		--		[5983] = {value = 25000, newItem = 5878, after = 4058}, -- minotaur guard/invader, after being killed
		[21092] = { value = 25000, newItem = 5878, after = 21093 }, -- mooh'tah warrior
		--		[21091] = {value = 25000, newItem = 5878, after = 21093}, -- mooh'tah warrior, after being killed
		[21096] = { value = 25000, newItem = 5878, after = 21097 }, -- minotaur hunter
		--		[21095] = {value = 25000, newItem = 5878, after = 21097}, -- minotaur hunter, after being killed
		[21100] = { value = 25000, newItem = 5878, after = 21101 }, -- worm priestess
		--		[21099] = {value = 25000, newItem = 5878, after = 21101}, -- worm priestess, after being killed
		--[21000] = {value = 25000, newItem = 5878, after = 21002}, -- minotaur amazon
		[21001] = { value = 25000, newItem = 5878, after = 21002 }, -- minotaur amazon, after being killed
		--[21004] = {value = 25000, newItem = 5878, after = 21006}, -- execowtioner
		[21005] = { value = 25000, newItem = 5878, after = 21006 }, -- execowtioner, after being killed
		--		[20996] = {value = 25000, newItem = 5878, after = 20998}, -- moohtant
		[20997] = { value = 25000, newItem = 5878, after = 20998 }, -- moohtant, after being killed
		--[21101] = {value = 25000, newItem = 5878},

		-- Low Class Lizards
		[4324] = { value = 25000, newItem = 5876, after = 4325 }, -- lizard sentinel
		--		[6040] = {value = 25000, newItem = 5876, after = 4325}, -- lizard sentinel, after being killed
		[4327] = { value = 25000, newItem = 5876, after = 4328 }, -- lizard snakecharmer
		--		[6041] = {value = 25000, newItem = 5876, after = 4328}, -- lizard snakecharmer, after being killed
		[4321] = { value = 25000, newItem = 5876, after = 4322 }, -- lizard templar
		--		[4239] = {value = 25000, newItem = 5876, after = 4322}, -- lizard templar, after being killed

		-- High Class Lizards
		[10368] = { value = 25000, newItem = 5876, after = 10369 }, -- lizard chosen,
		--		[10371] = {value = 25000, newItem = 5876, after = 10369}, -- lizard chosen, after being killed
		[10360] = { value = 25000, newItem = 5876, after = 10361 }, -- lizard dragon priest
		--		[10363] = {value = 25000, newItem = 5876, after = 10361}, -- lizard dragon priest, after being killed
		[10352] = { value = 25000, newItem = 5876, after = 10353 }, -- lizard high guard
		--		[10355] = {value = 25000, newItem = 5876, after = 10353}, -- lizard high guard, after being killed
		[10364] = { value = 25000, newItem = 5876, after = 10365 }, -- lizard zaogun
		--		[10367] = {value = 25000, newItem = 5876, after = 10365}, -- lizard zaogun, after being killed
		[10356] = { value = 25000, newItem = 5876, after = 10357 }, -- lizard legionnaire

		-- Dragons
		--		[4286] = {value = 25000, newItem = 5877, after = 4287}, -- dragon
		[4025] = { value = 25000, newItem = 5877, after = 4026 },
		--		[5973] = {value = 25000, newItem = 5877, after = 4287}, -- after being killed
		[271] = { value = 25000, newItem = 5877, after = 274 }, -- dragon hatchling
		-- Dragon Lords
		[4062] = { value = 25000, newItem = 5948, after = 4063 },
		--		[5984] = {value = 25000, newItem = 5948, after = 4063}, -- after being killed
		[272] = { value = 25000, newItem = 5948, after = 273 }, -- dragon lord hatchling
		-- Behemoths
		[4112] = { value = 35000, newItem = 5893, after = 4113 },
		--		[5999] = {value = 35000, newItem = 5893, after = 4113}, -- after being killed

		-- Bone Beasts
		[4212] = { value = 25000, newItem = 5925, after = 4213 },
		--		[6030] = {value = 25000, newItem = 5925, after = 4213}, -- after being killed

		-- Clomp - raw meat
		[22743] = { value = 25000, newItem = 22186, after = 22744 },
		--		[22742] = {value = 25000, newItem = 22186, after = 22744}, -- after being killed

		-- Wolf
		[4007] = { value = 25000, newItem = 5897 },
		--		[5968] = {value = 25000, newItem = 5897, after = 4008},

		-- Bear
		[4030] = { value = 15000, newItem = 5896 },
		--		[5975] = {value = 15000, newItem = 5896, after = 4031},

		-- Deer
		[4016] = { value = 15000, newItem = 10297 },
		--		[5970] = {value = 15000, newItem = 10297, after = 4017},

		-- Bat
		[4363] = { value = 30000, newItem = 5894 },
		--		[6053] = {value = 30000, newItem = 5894, after = 4364},

		-- Elephant
		[4360] = { value = 25000, newItem = 3044 },
		--		[6052] = {value = 25000, newItem = 3044, after = 4361},

		-- wyrm
		[8114] = { value = 20000, newItem = 9665 },
		--		[8113] = {value = 20000, newItem = 9665, after = 8115},

		-- elder wyrm
		[18967] = { value = 20000, newItem = 9665 },
		--		[18966] = {value = 25000, newItem = 9665, after = 18968},

		-- jung sea serpent
		[8966] = { value = 10000, newItem = 9666 },
		[8965] = { value = 10000, newItem = 9666, after = 8967 },

		-- sea serpent
		[951] = { value = 14000, newItem = 9666, after = 955 },
		--		[949] = {value = 20000, newItem = 9666, after = 955},

		-- hydra
		[4348] = { value = 15000, newItem = 10282 },
		--		[6048] = {value = 15000, newItem = 10282, after = 4349},

		-- Sheep
		[4086] = { value = 15000, newItem = 10319 },
		[5991] = { value = 15000, newItem = 10319, after = 4087 },

		-- chicken
		[4330] = { value = 25000, newItem = 5890 },
		[6042] = { value = 25000, newItem = 5890, after = 4331 },

		-- hellspawn
		[9010] = { value = 20000, newItem = 10304 },
		--		[9009] = {value = 20000, newItem = 10304, after = 9011},

		-- frost dragon
		[7092] = { value = 20000, newItem = 9661 },
		--		[7091] = {value = 20000, newItem = 9661, after = 7093},

		-- frost dragon hatch
		[910] = { value = 10000, newItem = 9661 },
		--		[909] = {value = 10000, newItem = 9661, after = 911},

		-- The Mutated Pumpkin
		[12816] = { { value = 5000, newItem = 123 }, { value = 10000, newItem = 7737 }, { value = 20000, 6492 }, { value = 30000, newItem = 8032 }, { value = 45000, newItem = 3594 }, { value = 60000, newItem = 2977 }, { value = 90000, newItem = 8177, amount = 50 } },
		--[8134] = { { value = 5000, newItem = 123 }, { value = 10000, newItem = 7737 }, { value = 20000, 6492 }, { value = 30000, newItem = 8032 }, { value = 45000, newItem = 3594 }, { value = 60000, newItem = 2977 }, { value = 90000, newItem = 8177, amount = 50 } },
		--[8135] = { { value = 5000, newItem = 123 }, { value = 10000, newItem = 7737 }, { value = 20000, 6492 }, { value = 30000, newItem = 8032 }, { value = 45000, newItem = 3594 }, { value = 60000, newItem = 2977 }, { value = 90000, newItem = 8177, amount = 50 } },
		-- Q3 ZMIANY
		-- Humans
		[4240] = {
			{ value = 3000, newItem = 5909, after = 4241 },
			{ value = 3000, newItem = 5910, after = 4241 },
			{ value = 4000, newItem = 5911, after = 4241 },
			{ value = 5000, newItem = 5912, after = 4241 },
			{ value = 5000, newItem = 5913, after = 4241 },
			{ value = 5000, newItem = 5914, after = 4241 },
			{ value = 35000, newItem = 3115, after = 4241 },
		},
		[4247] = {
			{ value = 3000, newItem = 5909, after = 4248 },
			{ value = 3000, newItem = 5910, after = 4248 },
			{ value = 4000, newItem = 5911, after = 4248 },
			{ value = 5000, newItem = 5912, after = 4248 },
			{ value = 5000, newItem = 5913, after = 4248 },
			{ value = 5000, newItem = 5914, after = 4248 },
			{ value = 35000, newItem = 3115, after = 4248 },
		},
		-- Q3 ZMIANY
	},
	[5942] = {
		-- Demon
		[4097] = { value = 12000, newItem = 5906 },
		--		[5995] = {value = 6000, newItem = 5906, after = 4098},

		-- Vampires
		[4137] = { value = 12000, newItem = 5905 },
		--		[6006] = {value = 6000, newItem = 5905, after = 4138},
		[8110] = { value = 12000, newItem = 5905 },
		[8738] = { value = 12000, newItem = 5905, after = 8742 },
		[18958] = { value = 12000, newItem = 5905 },
		--		[18961] = {value = 6000, newItem = 5905, after = 18959}
	},
}

local action = Action()

function action.onUse(player, item, fromPosition, target, toPosition, isHotkey)
	-- Q3
	if (target.itemid == 4240 or target.itemid == 4247) and player:getStorageValue(Storage.MilczenieOwiec.ModneUbrania) < 2 then
		return true
	end
	-- Q3
	-- Q4
	if (target.itemid == 4240 or target.itemid == 4247) and player:getStorageValue(Storage.MilczenieOwiec.GotujZLecterem) == 1 then
		local radn = math.random(10)
		if radn >= 4 and radn <= 7 then
			if player:getStorageValue(Storage.MilczenieOwiec.LudzkieWatroby) <= 19 then
				player:setStorageValue(Storage.MilczenieOwiec.LudzkieWatroby, player:getStorageValue(Storage.MilczenieOwiec.LudzkieWatroby) + 1) -- dodaje 1 watrobke
				player:say("Udalo ci sie wyciac watrobe.", TALKTYPE_MONSTER_SAY)
				toPosition:sendMagicEffect(CONST_ME_MAGIC_GREEN)
			else
				player:say("Dobra, kolejnej watroby nie potrzebuje.", TALKTYPE_MONSTER_SAY)
			end
		elseif radn >= 8 then
			if player:getStorageValue(Storage.MilczenieOwiec.LudzkieSerca) <= 14 then
				player:setStorageValue(Storage.MilczenieOwiec.LudzkieSerca, player:getStorageValue(Storage.MilczenieOwiec.LudzkieSerca) + 1) -- dodaje 1 serce
				player:say("Udalo ci sie wyciac serce.", TALKTYPE_MONSTER_SAY)
				toPosition:sendMagicEffect(CONST_ME_MAGIC_GREEN)
			else
				player:say("Dobra, kolejnego serca nie potrzebuje.", TALKTYPE_MONSTER_SAY)
			end
		else
			player:say("Ehh, musze jeszcze pocwiczyc.", TALKTYPE_MONSTER_SAY)
			toPosition:sendMagicEffect(CONST_ME_POFF)
		end
	end
	-- Q4
	local skin = config[item.itemid][target.itemid]
	if item.itemid == 5908 and target.itemid == 12369 and target.uid == 11018 then
		if player:getStorageValue(Storage.SciezkaDruida.PorwanyBenek) == 1 then
			doSendMagicEffect(toPosition, 49)
			doCreatureSay(toPosition, "Wuf wuf", TALKTYPE_ORANGE_1)
			player:setStorageValue(Storage.SciezkaDruida.PorwanyBenek, 2)
		end
		return true
	end
	if target.itemid == 10426 then -- marble sclupting
		local rand = math.random(6000)
		target:getPosition():sendMagicEffect(tonumber(10))
		if rand <= 3757 then
			if rand <= 830 then
				target:transform(10427)
				target:setDescription("Ta mizerna praca zostala wykonana przez " .. player:getName() .. ".")
				player:say("Slabo...", TALKTYPE_MONSTER_SAY)
			elseif rand > 900 and rand <= 4900 then
				target:transform(10428)
				target:setDescription("Ta mala statuetka zostala wykonana przez " .. player:getName() .. "... i wymaga poprawek.")
				player:say("Blisko perfekcji...", TALKTYPE_MONSTER_SAY)
			else
				target:transform(10429)
				target:setDescription("Ta statuetka zostala mistrzowsko wyrzezbiona przez " .. player:getName() .. ".")
				player:say("Brawo! Udalo sie, bedzie do CV.", TALKTYPE_MONSTER_SAY)
			end
		else
			player:say("Proba zakonczyla sie fiaskiem.", TALKTYPE_MONSTER_SAY)
			target:remove()
		end
		return true
	end

	if isInArray({ 7441, 7442, 7444, 7445 }, target.itemid) then -- ice cube
		local rand = math.random(50000)
		target:getPosition():sendMagicEffect(tonumber(10))
		if target.itemid == 7445 and rand <= 7000 then
			target:transform(7446)
		elseif target.itemid == 7444 and rand <= 10000 then
			target:transform(7445)
		elseif target.itemid == 7442 and rand <= 20000 then
			target:transform(7444)
		elseif target.itemid == 7441 and rand <= 31000 then
			target:transform(7442)
		else
			target:remove()
			player:say("Proba rzezbienia zakonczyla sie porazka.", TALKTYPE_MONSTER_SAY)
		end
		return true
	end

	--overlord
	if target.itemid == 8181 or target.itemid == 8182 then
		if player:getStorageValue(Storage.ElementalSphere.LordSkin) >= os.time() then
			return player:say("Nic tu nie ma..", TALKTYPE_MONSTER_SAY)
		end
		player:setStorageValue(Storage.ElementalSphere.LordSkin, os.time() + 3 * 60)
		player:addItem(954, 1)
		player:say("Pozyskales Neutralna Materie.", TALKTYPE_MONSTER_SAY)
		return true
	end

	if not skin then
		player:sendCancelMessage(RETURNVALUE_NOTPOSSIBLE)
		return true
	end

	local charmMType, chanceRange = player:getCharmMonsterType(CHARM_SCAVENGE), 100000
	if charmMType then
		local charmCorpse = charmMType:getCorpseId()
		if charmCorpse == target.itemid or ItemType(charmCorpse):getDecayId() == target.itemid then
			chanceRange = chanceRange * ((100 - GLOBAL_CHARM_SCAVENGE) / 100)
		end
	end

	local random, effect, transform = math.random(1, chanceRange), CONST_ME_MAGIC_GREEN, true
	if type(skin[1]) == "table" then
		local added = false
		for _, _skin in ipairs(skin) do
			if random <= _skin.value then
				player:addItem(_skin.newItem, _skin.amount or 1)
				added = true
				break
			end
		end

		if not added and target.itemid == 12816 then
			effect = CONST_ME_POFF
			transform = false
		end
	elseif random <= skin.value then
		local skinItem = player:addItem(skin.newItem, skin.amount or 1)
		player:sendLootStats(skinItem, skin.amount or 1)
	else
		effect = CONST_ME_POFF
	end

	toPosition:sendMagicEffect(effect)
	if transform and target.itemid ~= 12816 and target.itemid ~= 8134 and target.itemid ~= 8135 then
		target:transform(skin.after or target.itemid + 1)
	end

	return true
end

action:id(5908, 5942)
action:register()
